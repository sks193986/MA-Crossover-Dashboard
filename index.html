<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Investment Portfolio Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #333; line-height: 1.6; min-height: 100vh; }
        .dashboard-container { max-width: 1400px; margin: 0 auto; padding: 20px; }

        /* Header */
        .dashboard-header { background: rgba(255, 255, 255, 0.95); border-radius: 15px; padding: 25px; margin-bottom: 25px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); backdrop-filter: blur(10px); }
        .dashboard-header h1 { font-size: 2.2em; color: #2c3e50; margin-bottom: 15px; text-align: center; }
        .header-info { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; }
        .portfolio-summary { display: flex; gap: 25px; flex-wrap: wrap; }
        .summary-item { display: flex; flex-direction: column; align-items: center; padding: 15px 20px; background: #f8f9fa; border-radius: 10px; border-left: 4px solid #6c757d; }
        .summary-item.success { border-left-color: #28a745; }
        .summary-item.error { border-left-color: #dc3545; }
        .summary-number { font-size: 1.8em; font-weight: bold; color: #2c3e50; }
        .summary-label { font-size: 0.9em; color: #6c757d; text-transform: uppercase; letter-spacing: 0.5px; }

        /* Status Panel */
        .status-panel { background: rgba(255, 255, 255, 0.95); border-radius: 15px; padding: 20px; margin-bottom: 25px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; }
        .status-info { display: flex; flex-direction: column; gap: 8px; }
        .status-item { display: flex; align-items: center; gap: 10px; }
        .status-icon { font-size: 1.2em; }
        .status-text { color: #495057; font-weight: 500; }

        /* Buttons */
        .btn-main { background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 15px 30px; border-radius: 10px; font-size: 1.1em; font-weight: 600; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3); }
        .btn-main:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4); }
        .btn-main:disabled { opacity: 0.7; cursor: not-allowed; transform: none; }
        .btn-secondary { background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 8px; font-size: 0.95em; cursor: pointer; transition: all 0.3s ease; }
        .btn-secondary:hover { background: #5a6268; transform: translateY(-1px); }
        .settings-btn { background: #17a2b8; color: white; border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; }
        .settings-btn:hover { background: #138496; }

        /* Portfolio Section */
        .portfolio-section { background: rgba(255, 255, 255, 0.95); border-radius: 15px; padding: 25px; margin-bottom: 25px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px; }
        .section-header h2 { color: #2c3e50; font-size: 1.6em; }
        .portfolio-controls { display: flex; gap: 10px; }
        .portfolio-table-container { overflow-x: auto; border-radius: 10px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); }
        .portfolio-table { width: 100%; border-collapse: collapse; background: white; }
        .portfolio-table th, .portfolio-table td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #dee2e6; }
        .portfolio-table th { background: #f8f9fa; font-weight: 600; color: #495057; position: sticky; top: 0; }
        .sortable { cursor: pointer; user-select: none; }
        .sortable:hover { background: #e9ecef; }
        .portfolio-table tr:hover { background: #f8f9fa; }
        .position-above { color: #28a745; font-weight: 600; }
        .position-below { color: #dc3545; font-weight: 600; }
        .position-unknown { color: #6c757d; }

        /* Messages */
        .message { padding: 15px 20px; margin: 15px 0; border-radius: 10px; font-weight: 500; }
        .message.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .message.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .message.warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }

        /* Spinner */
        .spinner { display: inline-block; width: 16px; height: 16px; border: 2px solid #ffffff; border-radius: 50%; border-top-color: transparent; animation: spin 1s ease-in-out infinite; margin-right: 8px; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Responsive */
        @media (max-width: 768px) {
            .dashboard-container { padding: 15px; }
            .dashboard-header h1 { font-size: 1.8em; }
            .header-info { flex-direction: column; align-items: stretch; }
            .portfolio-summary { justify-content: center; }
            .status-panel { flex-direction: column; align-items: stretch; }
            .section-header { flex-direction: column; align-items: stretch; }
            .portfolio-controls { justify-content: center; }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <header class="dashboard-header">
            <h1>üìä My Investment Portfolio Dashboard</h1>
            <div class="header-info">
                <div class="portfolio-summary">
                    <div class="summary-item">
                        <span class="summary-number" id="total-investments">16</span>
                        <span class="summary-label">Investments</span>
                    </div>
                    <div class="summary-item success">
                        <span class="summary-number" id="above-ma">0</span>
                        <span class="summary-label">Above MA</span>
                    </div>
                    <div class="summary-item error">  
                        <span class="summary-number" id="below-ma">0</span>
                        <span class="summary-label">Below MA</span>
                    </div>
                </div>
                <button class="settings-btn" onclick="exportData()">üìä Export</button>
            </div>
        </header>

        <!-- Status Panel -->
        <div class="status-panel">
            <div class="status-info">
                <div class="status-item">
                    <span class="status-icon">‚úÖ</span>
                    <span class="status-text">API Connected - Ready to monitor your investments</span>
                </div>
                <div class="status-item">
                    <span class="status-icon">üéØ</span>
                    <span class="status-text" id="api-usage">API Usage: 0/500 requests today</span>
                </div>
            </div>
            <button class="btn-main" onclick="checkAllInvestments()" id="check-btn">üîÑ Check All My Investments</button>
        </div>

        <!-- Messages -->
        <div id="messages"></div>

        <!-- Portfolio Section -->
        <section class="portfolio-section">
            <div class="section-header">
                <h2>üìà My Investment Portfolio</h2>
                <div class="portfolio-controls">
                    <button onclick="refreshDisplay()" class="btn-secondary">üîÑ Refresh Display</button>
                </div>
            </div>

            <div class="portfolio-table-container">
                <table class="portfolio-table">
                    <thead>
                        <tr>
                            <th onclick="sortTable('symbol')" class="sortable"># Symbol ‚ÜïÔ∏è</th>
                            <th onclick="sortTable('name')" class="sortable">Investment Name ‚ÜïÔ∏è</th>
                            <th onclick="sortTable('type')" class="sortable">Type ‚ÜïÔ∏è</th>
                            <th onclick="sortTable('currentPrice')" class="sortable">Current Price ‚ÜïÔ∏è</th>
                            <th onclick="sortTable('ma50')" class="sortable">50-day MA ‚ÜïÔ∏è</th>
                            <th>Position vs MA</th>
                            <th>Distance from MA</th>
                            <th>Last Alert</th>
                        </tr>
                    </thead>
                    <tbody id="portfolio-tbody">
                        <tr>
                            <td colspan="8" style="text-align: center; padding: 40px; opacity: 0.7;">
                                <div style="font-size: 1.1em; margin-bottom: 10px;">üìä Your investments are loaded!</div>
                                <div>Click "Check All My Investments" above to get current prices and MA data</div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
    </div>

    <script>
        const API_KEY = 'KKV2RG3N00OPLLW1';

        // YOUR UNIQUE INVESTMENTS ONLY - No duplicates, no additions
        const investments = [
            { symbol: 'VOO', name: 'Vanguard S&P 500 ETF', type: 'Large Cap ETF' },
            { symbol: 'VEA', name: 'Vanguard Developed Markets ETF', type: 'International ETF' },
            { symbol: 'VTI', name: 'Vanguard Total Stock Market ETF', type: 'Broad Market ETF' },
            { symbol: 'EWJ', name: 'iShares MSCI Japan ETF', type: 'Country ETF' },
            { symbol: 'VWO', name: 'Vanguard Emerging Markets ETF', type: 'Emerging Markets ETF' },
            { symbol: 'EEM', name: 'iShares MSCI Emerging Markets ETF (HSBC MSCI equivalent)', type: 'Emerging Markets ETF' },
            { symbol: 'EWZ', name: 'iShares MSCI Brazil ETF (Amundi MSCI Brazil equivalent)', type: 'Country ETF' },
            { symbol: 'MCHI', name: 'iShares MSCI China ETF (Amundi MSCI China equivalent)', type: 'Country ETF' },
            { symbol: 'BTC', name: 'Bitcoin', type: 'Cryptocurrency' },
            { symbol: 'ETH', name: 'Ethereum', type: 'Cryptocurrency' },
            { symbol: 'SOL', name: 'Solana', type: 'Cryptocurrency' },
            { symbol: 'XRP', name: 'Ripple', type: 'Cryptocurrency' },
            { symbol: 'SLV', name: 'iShares Silver Trust ETF (Invesco Physical Silver equivalent)', type: 'Precious Metals ETF' },
            { symbol: 'GLD', name: 'SPDR Gold Trust ETF (Invesco Physical Gold equivalent)', type: 'Precious Metals ETF' },
            { symbol: 'GBPUSD', name: 'British Pound/USD', type: 'Forex Pair' },
            { symbol: 'USDINR', name: 'US Dollar/Indian Rupee', type: 'Forex Pair' }
        ];

        let portfolioData = investments.map(inv => ({
            ...inv,
            currentPrice: 0,
            ma50: 0,
            position: 'unknown',
            distance: 0,
            lastAlert: 'None'
        }));

        let isChecking = false;
        let apiCallsUsed = 0;

        function showMessage(message, type = 'success') {
            const messagesDiv = document.getElementById('messages');
            messagesDiv.innerHTML = `<div class="message ${type}">${message}</div>`;
            setTimeout(() => {
                messagesDiv.innerHTML = '';
            }, 8000);
        }

        function renderPortfolio() {
            const tbody = document.getElementById('portfolio-tbody');
            tbody.innerHTML = portfolioData.map((investment, index) => {
                const price = investment.currentPrice || 0;
                const ma50 = investment.ma50 || 0;
                const position = investment.position || 'unknown';
                const distance = investment.distance || 0;
                const lastAlert = investment.lastAlert || 'None';

                let positionClass = 'position-unknown';
                let positionText = '‚ö™ Not checked';
                if (position === 'above') {
                    positionClass = 'position-above';
                    positionText = 'üü¢ Above MA';
                } else if (position === 'below') {
                    positionClass = 'position-below';
                    positionText = 'üî¥ Below MA';
                }

                // Add emoji for investment type
                let typeEmoji = '';
                if (investment.type.includes('ETF')) typeEmoji = 'üè¢';
                else if (investment.type.includes('Crypto')) typeEmoji = '‚Çø';
                else if (investment.type.includes('Forex')) typeEmoji = 'üí±';

                return `
                    <tr>
                        <td><strong>${index + 1}. ${investment.symbol}</strong></td>
                        <td>${typeEmoji} ${investment.name}</td>
                        <td>${investment.type}</td>
                        <td>${price > 0 ? '$' + price.toFixed(2) : 'Not checked'}</td>
                        <td>${ma50 > 0 ? '$' + ma50.toFixed(2) : 'Not checked'}</td>
                        <td><span class="${positionClass}">${positionText}</span></td>
                        <td>${distance !== 0 ? (distance > 0 ? '+' : '') + distance.toFixed(2) + '%' : '0.00%'}</td>
                        <td>${lastAlert}</td>
                    </tr>
                `;
            }).join('');
        }

        function updateStats() {
            const total = portfolioData.length;
            const aboveMA = portfolioData.filter(inv => inv.position === 'above').length;
            const belowMA = portfolioData.filter(inv => inv.position === 'below').length;

            document.getElementById('total-investments').textContent = total;
            document.getElementById('above-ma').textContent = aboveMA;
            document.getElementById('below-ma').textContent = belowMA;
            document.getElementById('api-usage').textContent = `API Usage: ${apiCallsUsed}/500 requests today`;
        }

        async function fetchInvestmentData(investment) {
            try {
                let url, functionType;
                const typeLower = investment.type.toLowerCase();
                const symbol = investment.symbol;

                if (typeLower.includes('crypto')) {
                    functionType = 'DIGITAL_CURRENCY_DAILY';
                    url = `https://www.alphavantage.co/query?function=${functionType}&symbol=${symbol}&market=USD&apikey=${API_KEY}`;
                } else if (typeLower.includes('forex')) {
                    functionType = 'FX_DAILY';
                    const fromCurrency = symbol.substring(0, 3);
                    const toCurrency = symbol.substring(3);
                    url = `https://www.alphavantage.co/query?function=${functionType}&from_symbol=${fromCurrency}&to_symbol=${toCurrency}&apikey=${API_KEY}`;
                } else {
                    functionType = 'TIME_SERIES_DAILY';
                    url = `https://www.alphavantage.co/query?function=${functionType}&symbol=${symbol}&apikey=${API_KEY}`;
                }

                console.log(`Fetching data for ${symbol} using ${functionType}...`);
                const response = await fetch(url);
                const data = await response.json();

                apiCallsUsed++;

                if (data['Error Message']) {
                    throw new Error(data['Error Message']);
                }

                if (data['Note']) {
                    throw new Error('API rate limit reached');
                }

                let timeSeries;
                if (functionType === 'DIGITAL_CURRENCY_DAILY') {
                    timeSeries = data['Time Series (Digital Currency Daily)'];
                } else if (functionType === 'FX_DAILY') {
                    timeSeries = data['Time Series FX (Daily)'];
                } else {
                    timeSeries = data['Time Series (Daily)'];
                }

                if (!timeSeries) {
                    throw new Error('No time series data available');
                }

                const dates = Object.keys(timeSeries).sort().reverse();
                if (dates.length < 50) {
                    throw new Error(`Only ${dates.length} days of data available (need 50 for MA)`);
                }

                const recentDates = dates.slice(0, 50);
                const prices = [];

                for (const date of recentDates) {
                    const dayData = timeSeries[date];
                    let closePrice;

                    if (functionType === 'DIGITAL_CURRENCY_DAILY') {
                        closePrice = parseFloat(dayData['4a. close (USD)']);
                    } else if (functionType === 'FX_DAILY') {
                        closePrice = parseFloat(dayData['4. close']);
                    } else {
                        closePrice = parseFloat(dayData['4. close']);
                    }

                    if (!isNaN(closePrice)) {
                        prices.push(closePrice);
                    }
                }

                if (prices.length < 50) {
                    throw new Error('Insufficient valid price data');
                }

                const currentPrice = prices[0];
                const ma50 = prices.reduce((sum, price) => sum + price, 0) / prices.length;
                const position = currentPrice > ma50 ? 'above' : 'below';
                const distance = ((currentPrice - ma50) / ma50) * 100;

                return {
                    currentPrice,
                    ma50,
                    position,
                    distance,
                    success: true
                };

            } catch (error) {
                console.error(`Error fetching ${investment.symbol}:`, error.message);
                return {
                    success: false,
                    error: error.message
                };
            }
        }

        async function checkAllInvestments() {
            if (isChecking) {
                showMessage('Portfolio check already in progress! Please wait...', 'warning');
                return;
            }

            isChecking = true;
            const btn = document.getElementById('check-btn');
            btn.disabled = true;
            btn.innerHTML = '<span class="spinner"></span>Starting portfolio check...';

            showMessage('üöÄ Starting check of your investments... This will take several minutes due to API rate limits.', 'success');

            let successCount = 0;
            let errorCount = 0;

            for (let i = 0; i < portfolioData.length; i++) {
                const investment = portfolioData[i];

                btn.innerHTML = `<span class="spinner"></span>Checking ${investment.symbol} (${i + 1}/${portfolioData.length})...`;

                const result = await fetchInvestmentData(investment);

                if (result.success) {
                    portfolioData[i] = {
                        ...investment,
                        currentPrice: result.currentPrice,
                        ma50: result.ma50,
                        position: result.position,
                        distance: result.distance
                    };

                    successCount++;
                    console.log(`‚úÖ ${investment.symbol}: $${result.currentPrice.toFixed(2)} vs MA $${result.ma50.toFixed(2)} (${result.position})`);
                } else {
                    console.error(`‚ùå ${investment.symbol}: ${result.error}`);
                    errorCount++;
                }

                renderPortfolio();
                updateStats();

                if (i < portfolioData.length - 1) {
                    for (let countdown = 12; countdown > 0; countdown--) {
                        btn.innerHTML = `<span class="spinner"></span>Next check in ${countdown}s... (${i + 1}/${portfolioData.length} done)`;
                        await new Promise(resolve => setTimeout(resolve, 1000));
                    }
                }
            }

            btn.disabled = false;
            btn.innerHTML = 'üîÑ Check All My Investments';
            isChecking = false;

            let resultMessage = `‚úÖ Portfolio check complete! Successfully checked ${successCount} of your ${portfolioData.length} investments.`;
            if (errorCount > 0) resultMessage += ` ${errorCount} failed due to API limitations.`;

            showMessage(resultMessage, successCount > 0 ? 'success' : 'error');
        }

        function sortTable(key) {
            portfolioData.sort((a, b) => {
                let aVal = a[key] || 0;
                let bVal = b[key] || 0;

                if (typeof aVal === 'string') {
                    aVal = aVal.toLowerCase();
                    bVal = bVal.toLowerCase();
                }

                return aVal > bVal ? 1 : -1;
            });

            renderPortfolio();
        }

        function refreshDisplay() {
            renderPortfolio();
            updateStats();
            showMessage('üìä Display refreshed!', 'success');
        }

        function exportData() {
            try {
                const exportData = {
                    portfolio: portfolioData,
                    exportDate: new Date().toISOString(),
                    totalInvestments: portfolioData.length,
                    apiCallsUsed: apiCallsUsed
                };

                const blob = new Blob([JSON.stringify(exportData, null, 2)], {type: 'application/json'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `my-investments-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                showMessage('üìä Your investment portfolio data exported successfully!', 'success');
            } catch (error) {
                showMessage('‚ùå Error exporting data', 'error');
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            renderPortfolio();
            updateStats();
            showMessage('‚úÖ Dashboard loaded! Your investments are ready to check.', 'success');

            console.log('üìä Your Investment Portfolio Dashboard Loaded!');
            console.log('üîë API Key configured');
            console.log('üìà Ready to monitor:', portfolioData.map(inv => inv.symbol).join(', '));
        });
    </script>
</body>
</html>
