<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Investment Portfolio Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f5f5f5; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #333; margin-bottom: 30px; font-size: 2.2em; }
        .stats { display: flex; justify-content: center; gap: 30px; margin-bottom: 30px; }
        .stat { text-align: center; padding: 20px; background: #f8f9fa; border-radius: 10px; min-width: 150px; }
        .stat-number { font-size: 2.5em; font-weight: bold; color: #007bff; }
        .stat-label { font-size: 1em; color: #666; margin-top: 5px; }
        .check-btn { display: block; margin: 20px auto; padding: 20px 40px; background: #28a745; color: white; border: none; border-radius: 10px; font-size: 1.2em; font-weight: bold; cursor: pointer; transition: all 0.3s ease; }
        .check-btn:hover { background: #218838; transform: translateY(-2px); }
        .check-btn:disabled { background: #6c757d; cursor: not-allowed; transform: none; }
        table { width: 100%; border-collapse: collapse; margin-top: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-radius: 10px; overflow: hidden; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #eee; }
        th { background: #007bff; color: white; font-weight: 600; }
        tr:nth-child(even) { background: #f8f9fa; }
        tr:hover { background: #e3f2fd; }
        .above { color: #28a745; font-weight: bold; }
        .below { color: #dc3545; font-weight: bold; }
        .unknown { color: #6c757d; }
        .spinner { display: inline-block; width: 16px; height: 16px; border: 2px solid #fff; border-radius: 50%; border-top-color: transparent; animation: spin 1s linear infinite; margin-right: 8px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .message { padding: 15px; margin: 15px 0; border-radius: 8px; font-weight: bold; }
        .message.success { background: #d4edda; color: #155724; border: 2px solid #c3e6cb; }
        .message.error { background: #f8d7da; color: #721c24; border: 2px solid #f5c6cb; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ“Š My Investment Portfolio Dashboard</h1>
        
        <div class="stats">
            <div class="stat">
                <div class="stat-number" id="total-investments">16</div>
                <div class="stat-label">Total Investments</div>
            </div>
            <div class="stat">
                <div class="stat-number" id="above-ma">0</div>
                <div class="stat-label">Above 50-day MA</div>
            </div>
            <div class="stat">
                <div class="stat-number" id="below-ma">0</div>
                <div class="stat-label">Below 50-day MA</div>
            </div>
        </div>

        <button class="check-btn" onclick="checkAllInvestments()" id="check-btn">
            ðŸ”„ Check All My Investments
        </button>

        <div id="messages"></div>

        <table>
            <thead>
                <tr>
                    <th>Symbol</th>
                    <th>Investment Name</th>
                    <th>Type</th>
                    <th>Current Price</th>
                    <th>50-day MA</th>
                    <th>Position vs MA</th>
                    <th>Distance %</th>
                    <th>Last Alert</th>
                </tr>
            </thead>
            <tbody id="portfolio-table"></tbody>
        </table>

        <div style="margin-top: 40px;">
            <h3>ðŸš¨ MA Crossover Alerts</h3>
            <div id="alerts-list">
                <div style="text-align: center; padding: 30px; color: #666;">
                    ðŸ“Š No crossover alerts yet. Check your investments to start monitoring!
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_KEY = 'KKV2RG3N00OPLLW1';
        
        // WORKING INVESTMENTS - Only symbols that actually work with Alpha Vantage
        const investments = [
            { symbol: 'VOO', name: 'Vanguard S&P 500 ETF', type: 'US ETF' },
            { symbol: 'VEA', name: 'Vanguard Developed Markets ETF', type: 'US ETF' },
            { symbol: 'VTI', name: 'Vanguard Total Stock Market ETF', type: 'US ETF' },
            { symbol: 'EWJ', name: 'iShares MSCI Japan ETF', type: 'US ETF' },
            { symbol: 'VWO', name: 'Vanguard Emerging Markets ETF', type: 'US ETF' },
            { symbol: 'BTC', name: 'Bitcoin', type: 'Cryptocurrency' },
            { symbol: 'ETH', name: 'Ethereum', type: 'Cryptocurrency' },
            { symbol: 'SOL', name: 'Solana', type: 'Cryptocurrency' },
            { symbol: 'XRP', name: 'Ripple', type: 'Cryptocurrency' },
            { symbol: 'SLV', name: 'iShares Silver Trust ETF', type: 'US ETF' },
            { symbol: 'GLD', name: 'SPDR Gold Trust ETF', type: 'US ETF' },
            { symbol: 'GBPUSD', name: 'British Pound/USD', type: 'Forex' },
            { symbol: 'USDINR', name: 'US Dollar/Indian Rupee', type: 'Forex' },
            { symbol: 'VXUS', name: 'Vanguard Total International Stock ETF', type: 'US ETF' },
            { symbol: 'VB', name: 'Vanguard Small-Cap ETF', type: 'US ETF' },
            { symbol: 'VTEB', name: 'Vanguard Tax-Exempt Bond ETF', type: 'US ETF' }
        ];

        let portfolioData = investments.map(inv => ({
            ...inv,
            currentPrice: 0,
            ma50: 0,
            position: 'unknown',
            distance: 0,
            lastAlert: 'None'
        }));

        let alerts = [];
        let isChecking = false;

        function showMessage(message, type = 'success') {
            const messagesDiv = document.getElementById('messages');
            messagesDiv.innerHTML = `<div class="message ${type}">${message}</div>`;
            setTimeout(() => messagesDiv.innerHTML = '', 8000);
        }

        function renderPortfolio() {
            const tbody = document.getElementById('portfolio-table');
            tbody.innerHTML = portfolioData.map((inv, index) => {
                const price = inv.currentPrice || 0;
                const ma50 = inv.ma50 || 0;
                let positionText = 'âšª Not checked';
                let positionClass = 'unknown';
                
                if (inv.position === 'above') {
                    positionText = 'ðŸŸ¢ Above MA';
                    positionClass = 'above';
                } else if (inv.position === 'below') {
                    positionText = 'ðŸ”´ Below MA';  
                    positionClass = 'below';
                }

                return `
                    <tr>
                        <td><strong>${index + 1}. ${inv.symbol}</strong></td>
                        <td>${inv.name}</td>
                        <td>${inv.type}</td>
                        <td>${price > 0 ? '$' + price.toFixed(2) : 'Not checked'}</td>
                        <td>${ma50 > 0 ? '$' + ma50.toFixed(2) : 'Not checked'}</td>
                        <td><span class="${positionClass}">${positionText}</span></td>
                        <td>${inv.distance !== 0 ? (inv.distance > 0 ? '+' : '') + inv.distance.toFixed(2) + '%' : '0.00%'}</td>
                        <td>${inv.lastAlert}</td>
                    </tr>
                `;
            }).join('');

            const aboveCount = portfolioData.filter(inv => inv.position === 'above').length;
            const belowCount = portfolioData.filter(inv => inv.position === 'below').length;
            document.getElementById('above-ma').textContent = aboveCount;
            document.getElementById('below-ma').textContent = belowCount;
        }

        async function fetchData(symbol, type) {
            try {
                let url;
                
                if (type === 'Cryptocurrency') {
                    url = `https://www.alphavantage.co/query?function=DIGITAL_CURRENCY_DAILY&symbol=${symbol}&market=USD&apikey=${API_KEY}`;
                } else if (type === 'Forex') {
                    const from = symbol.substring(0, 3);
                    const to = symbol.substring(3);
                    url = `https://www.alphavantage.co/query?function=FX_DAILY&from_symbol=${from}&to_symbol=${to}&apikey=${API_KEY}`;
                } else {
                    url = `https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=${symbol}&apikey=${API_KEY}`;
                }

                console.log(`Fetching ${symbol}...`);
                const response = await fetch(url);
                const data = await response.json();
                
                if (data['Error Message'] || data['Note']) {
                    throw new Error(data['Error Message'] || 'API limit reached');
                }

                let timeSeries;
                if (type === 'Cryptocurrency') {
                    timeSeries = data['Time Series (Digital Currency Daily)'];
                } else if (type === 'Forex') {
                    timeSeries = data['Time Series FX (Daily)'];
                } else {
                    timeSeries = data['Time Series (Daily)'];
                }

                if (!timeSeries) throw new Error('No data available');

                const dates = Object.keys(timeSeries).sort().reverse();
                if (dates.length < 50) throw new Error('Insufficient data');

                const prices = dates.slice(0, 50).map(date => {
                    const dayData = timeSeries[date];
                    if (type === 'Cryptocurrency') {
                        return parseFloat(dayData['4a. close (USD)']);
                    } else {
                        return parseFloat(dayData['4. close']);
                    }
                });

                const currentPrice = prices[0];
                const ma50 = prices.reduce((sum, price) => sum + price, 0) / 50;

                return {
                    currentPrice,
                    ma50,
                    position: currentPrice > ma50 ? 'above' : 'below',
                    distance: ((currentPrice - ma50) / ma50) * 100,
                    success: true
                };
            } catch (error) {
                console.error(`Error fetching ${symbol}:`, error.message);
                return { success: false };
            }
        }

        async function checkAllInvestments() {
            if (isChecking) return;
            
            isChecking = true;
            const btn = document.getElementById('check-btn');
            btn.disabled = true;
            
            showMessage('ðŸš€ Starting portfolio check... This will take several minutes.', 'success');
            let successCount = 0;

            for (let i = 0; i < portfolioData.length; i++) {
                const investment = portfolioData[i];
                btn.innerHTML = `<span class="spinner"></span>Checking ${investment.symbol} (${i + 1}/${portfolioData.length})...`;
                
                const result = await fetchData(investment.symbol, investment.type);
                
                if (result.success) {
                    portfolioData[i] = { ...investment, ...result };
                    successCount++;
                }

                renderPortfolio();

                if (i < portfolioData.length - 1) {
                    for (let countdown = 12; countdown > 0; countdown--) {
                        btn.innerHTML = `<span class="spinner"></span>Next check in ${countdown}s... (${i + 1}/${portfolioData.length} done)`;
                        await new Promise(resolve => setTimeout(resolve, 1000));
                    }
                }
            }

            btn.innerHTML = 'ðŸ”„ Check All My Investments';
            btn.disabled = false;
            isChecking = false;
            
            showMessage(`âœ… Check complete! Successfully updated ${successCount} investments.`, 'success');
        }

        document.addEventListener('DOMContentLoaded', function() {
            renderPortfolio();
            showMessage('ðŸŽ¯ Dashboard loaded! Click the button to check your investments.', 'success');
        });
    </script>
</body>
</html>
